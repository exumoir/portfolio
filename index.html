<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CORE.IX | MOBILE OVERDRIVE</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">

    <style>
        :root { --neon: #00f2ff; --dark: #000000; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--dark); color: white;
            font-family: 'Space Grotesk', sans-serif; overflow: hidden;
            touch-action: none; /* Empêche le scroll natif pour laisser la 3D gérer */
        }

        #webgl-canvas { position: fixed; top: 0; left: 0; outline: none; z-index: 1; }

        /* INTERFACE MOBILE */
        #interface {
            position: fixed; inset: 0; z-index: 10;
            pointer-events: none; display: flex; flex-direction: column;
        }

        .navbar { pointer-events: auto; padding: 1rem; }
        .nav-link { 
            font-family: 'Syncopate'; font-size: 0.6rem; 
            letter-spacing: 1px; color: var(--neon) !important;
        }

        .section-content {
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; opacity: 0; transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            pointer-events: none; text-align: center;
        }
        .section-content.visible { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }

        .glitch-title {
            font-family: 'Syncopate'; font-size: 12vw; font-weight: 700;
            background: linear-gradient(to bottom, #fff, var(--neon));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0,242,255,0.5);
        }

        #init-btn {
            position: fixed; bottom: 15%; left: 50%; transform: translateX(-50%);
            padding: 12px 30px; border: 1px solid var(--neon);
            background: rgba(0,242,255,0.05); color: var(--neon);
            font-family: 'Syncopate'; font-size: 0.7rem; z-index: 100;
            pointer-events: auto; backdrop-filter: blur(5px);
        }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "gsap": "https://cdn.skypack.dev/gsap"
            }
        }
    </script>
</head>
<body>

    <button id="init-btn">SYSTEM SCAN START</button>
    <canvas id="webgl-canvas"></canvas>

    <div id="interface">
        <nav class="navbar navbar-expand px-2">
            <div class="navbar-nav mx-auto gap-3">
                <a class="nav-link" href="#" onclick="moveCam(0, 40, 0, 'lab')">LAB</a>
                <a class="nav-link" href="#" onclick="moveCam(30, 0, 30, 'data')">DATA</a>
                <a class="nav-link" href="#" onclick="moveCam(-30, -20, 10, 'comm')">COMM</a>
            </div>
        </nav>

        <div id="hero" class="section-content visible">
            <h1 class="glitch-title">CORE.IX</h1>
            <p class="small text-info opacity-75">MOBILE_NODE // ACTIVE</p>
        </div>

        <div id="lab" class="section-content">
            <h2 class="h4 fw-bold text-uppercase">Expériences</h2>
            <div class="row g-2 mt-3">
                <div class="col-6"><div class="p-2 border border-info small">WEBGL_01</div></div>
                <div class="col-6"><div class="p-2 border border-info small">SHAD_05</div></div>
            </div>
        </div>

        <div id="data" class="section-content">
            <h2 class="h4 fw-bold">STACK_TECH</h2>
            <p class="small text-white-50">THREE.JS / GSAP / GLSL</p>
        </div>

        <div id="comm" class="section-content">
            <h2 class="h4 fw-bold">LINK_START</h2>
            <input type="text" class="form-control bg-transparent border-info text-info mb-2 small" placeholder="NAME">
            <button class="btn btn-outline-info btn-sm w-100">SEND</button>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import gsap from 'gsap';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        let scene, camera, renderer, composer, grid, dummy;
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.03);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);
            camera.position.z = isMobile ? 60 : 40;

            renderer = new THREE.WebGLRenderer({ 
                canvas: document.querySelector('#webgl-canvas'), 
                antialias: !isMobile, // Désactive l'AA sur mobile pour gagner des FPS
                powerPreference: "high-performance" 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            composer = new EffectComposer(renderer);
            composer.addPass(new RenderPass(scene, camera));
            
            // Bloom léger sur mobile, fort sur PC
            const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), isMobile ? 0.8 : 1.5, 0.4, 0.85);
            composer.addPass(bloom);

            createGrid();
            animate();
        }

        function createGrid() {
            const count = isMobile ? 400 : 1000; // Moins de cubes sur mobile
            const geometry = new THREE.BoxGeometry(0.4, 0.4, 0.4);
            const material = new THREE.MeshBasicMaterial({ color: 0x00f2ff, transparent: true, opacity: 0.6 });
            
            grid = new THREE.InstancedMesh(geometry, material, count);
            dummy = new THREE.Object3D();
            
            for(let i = 0; i < count; i++) {
                dummy.position.set((Math.random()-0.5)*80, (Math.random()-0.5)*80, (Math.random()-0.5)*80);
                dummy.updateMatrix();
                grid.setMatrixAt(i, dummy.matrix);
            }
            scene.add(grid);
        }

        window.moveCam = (x, y, z, sectionId) => {
            gsap.to(camera.position, { 
                x, y, z: isMobile ? z + 50 : z + 30, 
                duration: 1.5, 
                ease: "power3.inOut" 
            });
            
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('visible'));
            document.getElementById(sectionId).classList.add('visible');
        };

        const btn = document.querySelector('#init-btn');
        btn.onclick = () => {
            gsap.to(btn, { opacity: 0, scale: 0, duration: 0.5, onComplete: () => btn.remove() });
            init();
        };

        function animate() {
            requestAnimationFrame(animate);
            if(grid) {
                grid.rotation.y += 0.001;
                grid.rotation.x += 0.0005;
            }
            composer.render();
        }

        // Tactile : Parallaxe gyroscope-like
        window.addEventListener('touchmove', (e) => {
            const touch = e.touches[0];
            const moveX = (touch.clientX / window.innerWidth) - 0.5;
            const moveY = (touch.clientY / window.innerHeight) - 0.5;
            gsap.to(camera.rotation, { y: -moveX * 0.2, x: moveY * 0.2, duration: 1 });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
